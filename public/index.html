<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unite Pet Salon Gallery | 高級ペットサロン</title>
    
    <!-- Unite Design System -->
    <link rel="stylesheet" href="unite-design.css">
    <link rel="stylesheet" href="unite-components.css">
    
    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-functions-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
</head>

<body class="loading">
    <noscript>
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); display: flex; align-items: center; justify-content: center; z-index: 9999;">
            <div style="background: white; padding: 2rem; border-radius: 12px; text-align: center; max-width: 400px;">
                <h1 style="color: #1e293b; margin-bottom: 1rem;">Unite Gallery</h1>
                <p style="color: #64748b;">JavaScript is required to access this gallery.</p>
            </div>
        </div>
    </noscript>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="unite-login-screen" style="display: none; opacity: 0;">
        <div class="unite-login-container">
            <div class="unite-login-header">
                <h1 id="loginTitle" class="unite-login-title">Unite Gallery</h1>
                <p class="unite-login-subtitle">Pet Salon Gallery Access</p>
            </div>
            
            <div class="unite-login-form">
                <div class="unite-auth-tabs">
                    <button class="unite-auth-tab active" data-tab="email">Email</button>
                    <button class="unite-auth-tab" data-tab="google">Google</button>
                </div>
                
                <div class="unite-auth-content" id="emailAuth">
                    <form id="emailLoginForm" role="form" aria-labelledby="loginTitle">
                        <div class="unite-form-group">
                            <label for="loginEmail">Email Address</label>
                            <input type="email" id="loginEmail" name="email" autocomplete="email" required placeholder="your@email.com" aria-label="Email Address">
                        </div>
                        <div class="unite-form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" name="password" autocomplete="current-password" required placeholder="Password" aria-label="Password">
                        </div>
                        <button type="submit" class="unite-btn unite-btn-primary unite-login-btn">
                            <i data-feather="log-in"></i>
                            Enter Gallery
                        </button>
                    </form>
                    
                    <div style="text-align: center; margin-top: var(--unite-space-lg); padding-top: var(--unite-space-lg); border-top: 1px solid var(--unite-pearl);">
                        <p style="font-size: var(--unite-text-sm); color: var(--unite-graphite); margin: 0; font-weight: 500;">
                            Authorized Access Only
                        </p>
                        <p style="font-size: var(--unite-text-xs); color: var(--unite-steel); margin-top: var(--unite-space-xs); margin-bottom: 0;">
                            許可されたアカウントのみアクセス可能です
                        </p>
                    </div>

                </div>
                
                <div class="unite-auth-content" id="googleAuth" style="display: none;">
                    <button id="googleLoginButton" class="unite-btn unite-btn-outline unite-login-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24">
                            <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        Sign in with Google
                    </button>
                </div>
                
                <div class="unite-auth-error" id="authError" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT (Hidden until authenticated) -->
    <div id="mainContent" class="unite-main-content" style="display: none; opacity: 0; visibility: hidden;">
        <!-- User Info Header -->
        <div class="unite-user-header">
            <div class="unite-user-info">
                <span id="userDisplayName">Loading...</span>
                <button id="logoutBtn" class="unite-btn unite-btn-ghost">
                    <i data-feather="log-out"></i>
                    Logout
                </button>
            </div>
        </div>
        
        <!-- UNITE GALLERY HERO -->
        <div class="unite-hero">
        <div class="unite-hero-content">
            <div class="unite-hero-text">
                <h1 class="unite-hero-title">
                    Unite Gallery<br>
                    <span class="unite-hero-subtitle">Pet Salon</span>
                </h1>
                <p class="unite-hero-description">
                    静寂な空間で、愛するペットとの特別な時間を。<br>
                    ギャラリーのような美しさと、最高級のサービスを提供します。
                </p>
            </div>
        </div>
        <div class="unite-hero-image">
            <!-- ここに大きなペット写真が入ります -->
            <div style="width: 100%; height: 500px; background: var(--unite-gradient-whisper); border-radius: var(--unite-radius-lg); display: flex; align-items: center; justify-content: center; color: var(--unite-graphite); font-size: var(--unite-text-sm);">
                Pet Gallery Image Area
            </div>
        </div>
    </div>

    <!-- MAIN EXHIBITION SPACE -->
    <div class="unite-container">
        
        <!-- TODAY'S EXHIBITION - Reservation Timeline -->
        <div class="unite-editorial-section">
            <div class="unite-editorial-header">
                <h2 class="unite-editorial-title">Today's Exhibition</h2>
                <p class="unite-editorial-subtitle">本日の予約スケジュール</p>
            </div>
            
            <div class="unite-timeline">
                <div class="unite-timeline-item">
                    <div class="unite-timeline-time">
                        09:00<br>
                        <span style="font-size: var(--unite-text-xs); color: var(--unite-graphite);">AM</span>
                    </div>
                    <div class="unite-timeline-content">
                        <div class="unite-guest-profile">
                            <img src="" alt="ペット写真" class="unite-pet-photo" style="background: linear-gradient(45deg, var(--unite-blue-silk), var(--unite-blue-serene));">
                            <div class="unite-guest-info">
                                <h4>ルナちゃん</h4>
                                <div class="unite-pet-details">
                                    トイプードル・3歳・オーナー：田中様<br>
                                    シャンプー・カット・爪切り・耳掃除
                                </div>
                                <div class="unite-service-tags">
                                    <span class="unite-service-tag">Premium Spa</span>
                                    <span class="unite-service-tag">Style Cut</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="unite-timeline-status">
                        <span class="unite-status unite-status-confirmed">Confirmed</span>
                    </div>
                </div>

                <div class="unite-timeline-item">
                    <div class="unite-timeline-time">
                        10:30<br>
                        <span style="font-size: var(--unite-text-xs); color: var(--unite-graphite);">AM</span>
                    </div>
                    <div class="unite-timeline-content">
                        <div class="unite-guest-profile">
                            <img src="" alt="ペット写真" class="unite-pet-photo" style="background: linear-gradient(45deg, var(--unite-blue-mist), var(--unite-blue-serene));">
                            <div class="unite-guest-info">
                                <h4>チョコくん</h4>
                                <div class="unite-pet-details">
                                    柴犬・5歳・オーナー：佐藤様<br>
                                    シャンプー・ブロー・部分カット
                                </div>
                                <div class="unite-service-tags">
                                    <span class="unite-service-tag">Basic Care</span>
                                    <span class="unite-service-tag">Nail Trim</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="unite-timeline-status">
                        <span class="unite-status unite-status-progress">In Progress</span>
                    </div>
                </div>

                <div class="unite-timeline-item">
                    <div class="unite-timeline-time">
                        14:00<br>
                        <span style="font-size: var(--unite-text-xs); color: var(--unite-graphite);">PM</span>
                    </div>
                    <div class="unite-timeline-content">
                        <div class="unite-guest-profile">
                            <img src="" alt="ペット写真" class="unite-pet-photo" style="background: linear-gradient(45deg, var(--unite-blue-whisper), var(--unite-blue-mist));">
                            <div class="unite-guest-info">
                                <h4>ミミちゃん</h4>
                                <div class="unite-pet-details">
                                    マルチーズ・2歳・オーナー：山田様<br>
                                    フルコース・アロマバス・毛玉取り
                                </div>
                                <div class="unite-service-tags">
                                    <span class="unite-service-tag">Luxury Spa</span>
                                    <span class="unite-service-tag">Aromatherapy</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="unite-timeline-status">
                        <span class="unite-status unite-status-pending">Pending</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ATTENTION GALLERY -->
        <div class="unite-editorial-section">
            <div class="unite-editorial-header">
                <h2 class="unite-editorial-title">Attention Gallery</h2>
                <p class="unite-editorial-subtitle">特別なケアが必要なゲスト様</p>
            </div>
            
            <div class="unite-attention-grid">
                <div class="unite-attention-card">
                    <div class="unite-attention-header">
                        <img src="" alt="ペット写真" class="unite-attention-photo" style="background: linear-gradient(45deg, #fbbf24, #f59e0b);">
                        <div class="unite-attention-info">
                            <h5>ハナちゃん</h5>
                            <p class="unite-attention-owner">ゴールデンレトリバー・鈴木様</p>
                        </div>
                    </div>
                    <p class="unite-attention-note">
                        皮膚が敏感なため、低刺激シャンプーを使用。ドライヤーの温度は低めに設定してください。
                    </p>
                    <div class="unite-attention-tags">
                        <span class="unite-attention-tag unite-tag-medical">Medical</span>
                    </div>
                </div>

                <div class="unite-attention-card">
                    <div class="unite-attention-header">
                        <img src="" alt="ペット写真" class="unite-attention-photo" style="background: linear-gradient(45deg, #ef4444, #dc2626);">
                        <div class="unite-attention-info">
                            <h5>タロウくん</h5>
                            <p class="unite-attention-owner">秋田犬・高橋様</p>
                        </div>
                    </div>
                    <p class="unite-attention-note">
                        初回来店で緊張しています。ゆっくりと慣らしながら作業を進めてください。
                    </p>
                    <div class="unite-attention-tags">
                        <span class="unite-attention-tag unite-tag-behavioral">Behavioral</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- COLLECTION ANALYTICS -->
        <div class="unite-editorial-section">
            <div class="unite-analytics">
                <div class="unite-analytics-header">
                    <div>
                        <h2 class="unite-analytics-title">Collection Analytics</h2>
                        <p class="unite-analytics-subtitle">サロンパフォーマンス・アナリティクス</p>
                    </div>
                    <div class="unite-period-tabs">
                        <button class="unite-period-tab active">Today</button>
                        <button class="unite-period-tab">Week</button>
                        <button class="unite-period-tab">Month</button>
                    </div>
                </div>
                
                <div class="unite-chart-area">
                    <div class="unite-chart-placeholder">
                        📊 Chart Area<br>
                        <span style="color: var(--unite-steel); font-size: var(--unite-text-xs);">
                            予約数・売上・顧客満足度のグラフがここに表示されます
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACTIVITY EXHIBITION -->
        <div class="unite-editorial-section">
            <div class="unite-editorial-header">
                <h2 class="unite-editorial-title">Activity Exhibition</h2>
                <p class="unite-editorial-subtitle">本日のサロン活動履歴</p>
            </div>
            
            <div class="unite-activity">
                <div class="unite-activity-list">
                    <div class="unite-activity-item">
                        <div class="unite-activity-icon" style="background: var(--unite-blue-silk); color: var(--unite-blue-refined);">
                            <i data-feather="calendar"></i>
                        </div>
                        <div class="unite-activity-content">
                            <h6>新規予約を受付</h6>
                            <p>ももちゃん（チワワ）の予約を明日15:00で受付いたしました。</p>
                        </div>
                        <div class="unite-activity-time">
                            10分前
                        </div>
                    </div>

                    <div class="unite-activity-item">
                        <div class="unite-activity-icon" style="background: var(--unite-purple-mist); color: var(--unite-steel);">
                            <i data-feather="check-circle"></i>
                        </div>
                        <div class="unite-activity-content">
                            <h6>サービス完了</h6>
                            <p>チョコくん（柴犬）のシャンプー・カットが完了しました。</p>
                        </div>
                        <div class="unite-activity-time">
                            25分前
                        </div>
                    </div>

                    <div class="unite-activity-item">
                        <div class="unite-activity-icon" style="background: var(--unite-mist); color: var(--unite-graphite);">
                            <i data-feather="edit-3"></i>
                        </div>
                        <div class="unite-activity-content">
                            <h6>顧客情報を更新</h6>
                            <p>ルナちゃんの健康状態・アレルギー情報を更新しました。</p>
                        </div>
                        <div class="unite-activity-time">
                            1時間前
                        </div>
                    </div>

                    <div class="unite-activity-item">
                        <div class="unite-activity-icon" style="background: var(--unite-blue-serene); color: white;">
                            <i data-feather="dollar-sign"></i>
                        </div>
                        <div class="unite-activity-content">
                            <h6>お支払い処理</h6>
                            <p>田中様（ルナちゃんの飼い主）からのお支払いを受け取りました。</p>
                        </div>
                        <div class="unite-activity-time">
                            2時間前
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACTION GALLERY -->
        <div class="unite-editorial-section">
            <div class="unite-editorial-header">
                <h2 class="unite-editorial-title">Quick Actions</h2>
                <p class="unite-editorial-subtitle">よく使用する機能</p>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--unite-space-lg);">
                <button class="unite-btn unite-btn-primary" data-tab="calendar" style="justify-content: center; padding: var(--unite-space-lg);">
                    <i data-feather="plus-circle"></i>
                    新規予約登録
                </button>
                
                <button class="unite-btn unite-btn-outline" data-tab="customer" style="justify-content: center; padding: var(--unite-space-lg);">
                    <i data-feather="users"></i>
                    顧客管理
                </button>
                
                <button class="unite-btn unite-btn-outline" data-tab="ops" style="justify-content: center; padding: var(--unite-space-lg);">
                    <i data-feather="calendar"></i>
                    オペレーション
                </button>
                
                <button class="unite-btn unite-btn-outline" data-tab="settings" style="justify-content: center; padding: var(--unite-space-lg);">
                    <i data-feather="settings"></i>
                    設定
                </button>
            </div>
        </div>
    </div>

    <!-- HIDDEN APPLICATION STRUCTURE (from original index.html) -->
    <div id="appStructure" style="display: none;">
        <!-- 管理機能用DOM要素 -->
        
        <!-- スタッフ管理 -->
        <div id="staffList" class="list-container"></div>
        <form id="staffForm" class="form-container">
            <input type="text" name="name" placeholder="スタッフ名" autocomplete="name" required>
            <input type="email" name="email" placeholder="メールアドレス" autocomplete="email">
            <button type="submit" id="btnCreateStaff">スタッフ登録</button>
        </form>
        <div id="staffMsg" class="message-area"></div>
        
        <!-- 支払方法管理 -->
        <div id="paymentList" class="list-container"></div>
        <form id="paymentForm" class="form-container">
            <input type="text" name="name" placeholder="支払方法名" autocomplete="off" required>
            <input type="text" name="code" placeholder="コード" autocomplete="off" required>
            <input type="number" name="sort" placeholder="表示順" autocomplete="off" min="0">
            <button type="submit" id="btnCreatePayment">支払方法登録</button>
        </form>
        <div id="pmMsg" class="message-area"></div>
        
        <!-- チケット管理 -->
        <div id="ticketList" class="list-container"></div>
        <form id="ticketForm" class="form-container">
            <input type="text" name="title" placeholder="タイトル" autocomplete="off" required>
            <select name="category">
                <option value="問い合わせ">問い合わせ</option>
                <option value="要望">要望</option>
                <option value="バグ報告">バグ報告</option>
            </select>
            <textarea name="description" placeholder="詳細説明" autocomplete="off"></textarea>
            <button type="submit" id="btnCreateTicket">チケット作成</button>
        </form>
        <div id="ticketMsg" class="message-area"></div>
        
        <!-- その他の管理要素 -->
        <div id="customerList" class="list-container"></div>
        <div id="petList" class="list-container"></div>
        <div id="appointmentList" class="list-container"></div>
        <div id="serviceList" class="list-container"></div>
    </div>
    </div>
    <!-- End of Main Content -->



    <script>
        // Firebase Configuration - Disabled for demo mode
        // デモ環境ではFirebase API呼び出しを防止するため、無効化
        // firebaseConfig will be declared below
        
        // 本番環境では以下のような設定を使用してください。
        // const firebaseConfig = {
        //     apiKey: "your-real-api-key",
        //     authDomain: "your-project.firebaseapp.com",
        //     projectId: "your-project-id",
        //     storageBucket: "your-project.appspot.com",
        //     messagingSenderId: "your-sender-id",
        //     appId: "your-app-id"
        // };

        // Firebase initialization for Unite Gallery
        let firebaseApp = null;
        let isFirebaseInitialized = false;
        
        // Firebase初期化を確実に実行
        function initializeFirebase() {
            console.log('🔥 Starting Firebase initialization...');
            
            if (typeof firebase === 'undefined') {
                console.error('❌ Firebase SDK not loaded');
                return false;
            }
            
            if (!window.firebaseConfig) {
                console.error('❌ Firebase configuration not loaded');
                return false;
            }
            
            try {
                // Firebase App初期化
                if (firebase.apps.length === 0) {
                    firebaseApp = firebase.initializeApp(window.firebaseConfig);
                    console.log('✅ Firebase App initialized successfully with external config');
                } else {
                    firebaseApp = firebase.apps[0];
                    console.log('✅ Using existing Firebase App instance');
                }
                
                // Firebase Auth service検証
                if (!firebase.auth) {
                    throw new Error('Firebase Auth service not available');
                }
                
                // Auth service初期化テスト
                const auth = firebase.auth();
                if (!auth) {
                    throw new Error('Cannot get Firebase Auth instance');
                }
                
                console.log('✅ Firebase Auth service verified');
                isFirebaseInitialized = true;
                return true;
                
            } catch (error) {
                console.error('❌ Firebase initialization failed:', error);
                firebaseApp = null;
                isFirebaseInitialized = false;
                return false;
            }
        }
        
        // Authentication State Management
        let currentUser = null;

        // 正常な初期化フロー管理
        function completeInitialization() {
            // 初期化完了時にloadingクラスを削除
            document.body.classList.remove('loading');
            console.log('✅ Unite Gallery初期化完了 - ローディング状態解除');
        }

        // Check authentication state on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Unite Gallery初期化開始...');
            
            // Firebase初期化をDOMContentLoaded後に実行（設定ファイル読み込み確実化）
            const firebaseReady = initializeFirebase();
            
            try {
                // Initialize Feather Icons first
                if (typeof feather !== 'undefined' && feather.replace) {
                    feather.replace();
                    console.log('✅ Feather icons initialized');
                } else {
                    console.log('⚠️ Feather icons not available');
                }
                
                // Firebase認証監視は正しく初期化された場合のみ
                if (isFirebaseInitialized && typeof firebase !== 'undefined' && firebase.auth && firebaseApp) {
                    console.log('✅ Firebase authentication monitoring started');
                    
                    // 現在の認証状態を即座にチェック
                    const currentAuthUser = firebase.auth().currentUser;
                    if (currentAuthUser) {
                        console.log('📝 既存の認証セッション検出:', currentAuthUser.email);
                        // 既存セッションがある場合、ちらつき防止のためログイン画面をスキップ
                        const authorizedUID = 'IbuYD2GuBTdS55LY5uuzBsHIF7s2';
                        if (currentAuthUser.uid === authorizedUID) {
                            console.log('📝 既存セッション認証成功 - 直接メイン画面へ');
                            currentUser = currentAuthUser;
                            window.currentUser = currentAuthUser;
                            showMainContent(currentAuthUser);
                        } else {
                            console.log('📝 既存セッション認証失敗 - ログアウト');
                            firebase.auth().signOut();
                            showLoginScreen();
                        }
                    } else {
                        console.log('📝 既存セッションなし - ログイン画面表示');
                        // 滑らかなフェードインでログイン画面を表示
                        setTimeout(() => {
                            showLoginScreen();
                        }, 100);
                    }
                    
                    firebase.auth().onAuthStateChanged((user) => {
                        const authorizedUID = 'IbuYD2GuBTdS55LY5uuzBsHIF7s2';
                        
                        if (user) {
                            // Check if the user's UID is authorized
                            if (user.uid === authorizedUID) {
                                console.log('Firebase user login detected - authorized UID:', user.email);
                                currentUser = user;
                                window.currentUser = user;
                                showMainContent(user);
                            } else {
                                console.log('Firebase user login detected - unauthorized UID:', user.uid);
                                firebase.auth().signOut();
                                showLoginScreen();
                                showAuthError('このアカウントは許可されていません。');
                            }
                        } else {
                            // User is signed out
                            console.log('Firebase user logout');
                            currentUser = null;
                            window.currentUser = null;
                            showLoginScreen();
                        }
                    });
                } else {
                    console.log('❌ Firebase authentication not available - initialization failed or missing');
                    console.log('❌ isFirebaseInitialized:', isFirebaseInitialized);
                    console.log('❌ firebase available:', typeof firebase !== 'undefined');
                    console.log('❌ firebase.auth available:', typeof firebase !== 'undefined' && !!firebase.auth);
                    console.log('❌ firebaseApp:', !!firebaseApp);
                    // Firebase利用不可の場合はログイン画面を表示
                    showLoginScreen();
                    console.log('📝 Firebase利用不可 - ログイン画面表示');
                }
                
                setupEventListeners();
                
                // 初期化完了 - ローディング状態解除（認証状態確定後）
                setTimeout(() => {
                    completeInitialization();
                }, 300);
            } catch (error) {
                console.error('❌ 初期化エラー:', error);
                // エラー時もloadingクラスを削除してログイン画面を表示
                completeInitialization();
                const loginScreen = document.getElementById('loginScreen');
                if (loginScreen) {
                    loginScreen.style.display = 'flex';
                    loginScreen.style.opacity = '1';
                }
                showAuthError('初期化エラーが発生しました。ページを再読み込みしてください。');
            }
        });

        function showLoginScreen() {
            // loading状態を解除して画面表示を確実にする
            completeInitialization();
            
            const loginScreen = document.getElementById('loginScreen');
            const mainContent = document.getElementById('mainContent');
            if (loginScreen && mainContent) {
                // メインコンテンツを非表示
                mainContent.style.display = 'none';
                mainContent.style.opacity = '0';
                mainContent.style.visibility = 'hidden';
                mainContent.classList.remove('loaded');
                
                // ログイン画面を滑らかに表示
                loginScreen.style.display = 'flex';
                loginScreen.style.visibility = 'visible';
                
                // フェードインアニメーション
                requestAnimationFrame(() => {
                    loginScreen.style.opacity = '1';
                });
                
                console.log('📝 ログイン画面表示完了');
            } else {
                console.error('❌ ログイン画面要素が見つかりません');
            }
        }

        function showMainContent(user) {
            console.log('Showing main content for user:', user?.email);
            
            // loading状態を解除して画面表示を確実にする
            completeInitialization();
            
            const loginScreen = document.getElementById('loginScreen');
            const mainContent = document.getElementById('mainContent');
            const userDisplay = document.getElementById('userDisplayName');
            
            if (loginScreen && mainContent) {
                // ログイン画面をフェードアウト
                loginScreen.style.opacity = '0';
                setTimeout(() => {
                    loginScreen.style.display = 'none';
                    loginScreen.style.visibility = 'hidden';
                }, 200);
                
                // メインコンテンツを表示
                mainContent.style.display = 'block';
                mainContent.style.visibility = 'visible';
                
                // フェードインアニメーション
                requestAnimationFrame(() => {
                    mainContent.style.opacity = '1';
                    mainContent.classList.add('fade-in');
                });
                
                // Update user display
                if (userDisplay) {
                    const displayName = user?.displayName || user?.email || 'Gallery User';
                    userDisplay.textContent = displayName;
                }
                
                // Sync authentication state with app.js
                window.currentUser = user;
                window.isAuthenticated = true;
                currentUser = user;
                
                // Update app.js authentication state if available
                if (typeof window.updateAuthState === 'function') {
                    window.updateAuthState(user, true);
                    console.log('✅ app.js認証状態を同期しました');
                }
                
                // Add loaded animation
                setTimeout(() => {
                    mainContent.classList.add('loaded');
                    console.log('Main content animation completed');
                }, 100);
                
                console.log('Screen switch completed successfully');
            } else {
                console.error('Required elements not found:', { loginScreen: !!loginScreen, mainContent: !!mainContent });
            }
        }

        function setupEventListeners() {
            try {
                // Debug: Check form accessibility
                console.log('Setting up event listeners...');
                const emailInput = document.getElementById('loginEmail');
                const passwordInput = document.getElementById('loginPassword');
                
                if (emailInput) {
                    console.log('Email input found:', emailInput);
                    emailInput.addEventListener('focus', () => console.log('Email input focused'));
                    emailInput.addEventListener('input', () => console.log('Email input changed:', emailInput.value));
                } else {
                    console.error('Email input not found!');
                }
                
                if (passwordInput) {
                    console.log('Password input found:', passwordInput);
                    passwordInput.addEventListener('focus', () => console.log('Password input focused'));
                    passwordInput.addEventListener('input', () => console.log('Password input changed'));
                } else {
                    console.error('Password input not found!');
                }
                
                // Auth tab switching
                const authTabs = document.querySelectorAll('.unite-auth-tab');
                authTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const targetTab = this.getAttribute('data-tab');
                        document.querySelectorAll('.unite-auth-tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        document.querySelectorAll('.unite-auth-content').forEach(content => {
                            content.style.display = 'none';
                        });
                        document.getElementById(targetTab + 'Auth').style.display = 'block';
                    });
                });

                // Email login form
                const emailForm = document.getElementById('emailLoginForm');
                if (emailForm) {
                    emailForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        console.log('📝 Email login form submitted');
                        handleEmailLogin();
                    });
                }
                
                // Login button click handler (backup)
                const loginBtn = document.querySelector('.unite-login-btn');
                if (loginBtn) {
                    loginBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('📝 Login button clicked directly');
                        handleEmailLogin();
                    });
                }

                // Google login button
                const googleBtn = document.getElementById('googleLoginButton');
                if (googleBtn) {
                    googleBtn.addEventListener('click', function() {
                        handleGoogleLogin();
                    });
                }



                // Logout button
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function() {
                        handleLogout();
                    });
                }

                // Period tab functionality
                const periodTabs = document.querySelectorAll('.unite-period-tab');
                periodTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.unite-period-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                    });
                });

                // Action button functionality - now works after login
                const actionButtons = document.querySelectorAll('[data-tab]');
                actionButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const tab = this.getAttribute('data-tab');
                        if (tab && currentUser) {
                            // User is authenticated, handle tab switching
                            console.log('Switching to tab:', tab);
                            // Add your tab switching logic here
                        }
                    });
                });
            } catch (error) {
                console.error('Event listener setup error:', error);
            }
        }

        function handleEmailLogin() {
            console.log('📝 handleEmailLogin function called');
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            console.log('📝 Login attempt with email:', email.substring(0, 5) + '...');

            // Firebase UIDベースの認証システム
            const authorizedUID = 'IbuYD2GuBTdS55LY5uuzBsHIF7s2';
            
            console.log('📝 Attempting Firebase Authentication...');
            
            // Firebase状態の詳細チェック
            console.log('🔍 Firebase状態チェック:');
            console.log('  - isFirebaseInitialized:', isFirebaseInitialized);
            console.log('  - firebase available:', typeof firebase !== 'undefined');
            console.log('  - firebase.auth available:', typeof firebase !== 'undefined' && !!firebase.auth);
            console.log('  - firebaseApp:', !!firebaseApp);
            
            if (!isFirebaseInitialized) {
                console.log('❌ Firebase not initialized - attempting reinitialization...');
                const reinitSuccess = initializeFirebase();
                if (!reinitSuccess) {
                    showAuthError('Firebase認証サービスの初期化に失敗しました。ページをリロードしてください。');
                    return;
                }
            }
            
            if (typeof firebase === 'undefined' || !firebase.auth) {
                console.log('❌ Firebase Auth service unavailable');
                showAuthError('Firebase認証サービスが利用できません。ページをリロードしてください。');
                return;
            }
            
            // Firebase Authenticationでログイン
            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log('✅ Firebase authentication successful');
                    console.log('📝 User UID:', user.uid);
                    console.log('📝 Expected UID:', authorizedUID);
                    
                    // UIDチェック
                    if (user.uid === authorizedUID) {
                        console.log('✅ Authorized UID confirmed - access granted');
                        
                        // Set authentication state
                        currentUser = user;
                        window.currentUser = user;
                        window.isAuthenticated = true;
                        
                        hideAuthError();
                        showMainContent(user);
                        console.log('✅ Firebase UID login completed successfully');
                    } else {
                        console.log('❌ Unauthorized UID - access denied');
                        console.log('❌ User UID:', user.uid);
                        console.log('❌ Expected UID:', authorizedUID);
                        
                        // Sign out unauthorized user
                        firebase.auth().signOut();
                        showAuthError('このアカウントは許可されていません。');
                    }
                })
                .catch((error) => {
                    console.log('❌ Firebase authentication failed:', error.code, error.message);
                    
                    let errorMessage = '認証に失敗しました。';
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'アカウントが見つかりません。';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'パスワードが正しくありません。';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'メールアドレスの形式が正しくありません。';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'ログイン試行回数が上限に達しました。しばらく時間をおいてから再度お試しください。';
                    }
                    
                    showAuthError(errorMessage);
                });
            
            return;

            // Firebaseが有効で本番設定の場合のみ実際の認証を試みる
            // デモ環境ではFirebase認証を完全にスキップしてエラーを防止
            const isValidFirebaseConfig = typeof firebase !== 'undefined' && 
                firebase.auth && firebaseApp && 
                firebaseConfig.apiKey && 
                !firebaseConfig.apiKey.includes('Demo') &&
                !firebaseConfig.apiKey.includes('demo') &&
                firebaseConfig.apiKey.length > 30; // 有効なAPIキーは通常30文字以上
            
            if (isValidFirebaseConfig) {
                console.log('Valid Firebase configuration found, attempting authentication');
                firebase.auth().signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        const authorizedUID = 'IbuYD2GuBTdS55LY5uuzBsHIF7s2';
                        
                        // Check if the user's UID matches the authorized UID
                        if (user.uid === authorizedUID) {
                            hideAuthError();
                            console.log('✓ Firebase認証成功 - 許可されたUID');
                        } else {
                            // Sign out unauthorized user
                            firebase.auth().signOut();
                            showAuthError('このアカウントは許可されていません。');
                            console.log('Firebase認証成功but unauthorized UID:', user.uid);
                        }
                    })
                    .catch((error) => {
                        console.error('Firebase authentication error:', error);
                        console.log('Firebase authentication error, falling back to demo mode');
                        
                        showAuthError('Authentication failed. Please check your email and password.');
                    });
            } else {
                // Firebaseが無効の場合でも許可されたアカウントのみアクセス可能
                console.log('Firebase not available - only authorized accounts allowed');
                showAuthError('認証サービスが利用できません。許可されたアカウントでのみアクセスできます。');
            }
        }

        function handleGoogleLogin() {
            if (typeof firebase !== 'undefined' && firebase.auth && firebaseApp) {
                const provider = new firebase.auth.GoogleAuthProvider();
                firebase.auth().signInWithPopup(provider)
                    .then((result) => {
                        // Success - onAuthStateChanged will handle UI update
                        hideAuthError();
                    })
                    .catch((error) => {
                        showAuthError(error.message);
                    });
            } else {
                console.log('❌ Firebase not available for Google login');
                showAuthError('Firebase認証サービスが利用できません。');
            }
        }



        function handleLogout() {
            if (typeof firebase !== 'undefined' && firebase.auth && firebaseApp) {
                firebase.auth().signOut().then(() => {
                    // Success - onAuthStateChanged will handle UI update
                }).catch((error) => {
                    console.error('Logout error:', error);
                });
            } else {
                // Demo mode
                currentUser = null;
                showLoginScreen();
                const mainContent = document.getElementById('mainContent');
                if (mainContent) {
                    mainContent.classList.remove('loaded');
                }
            }
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('authError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideAuthError() {
            document.getElementById('authError').style.display = 'none';
        }
        
        // Add smooth scrolling behavior
        document.documentElement.style.scrollBehavior = 'smooth';
        
        // 安全装置: 3秒後にloading状態が残っている場合のフォールバック
        setTimeout(() => {
            if (document.body.classList.contains('loading')) {
                console.warn('⚠️ Loading状態が残存 - フォールバック実行');
                completeInitialization();
                // ログイン画面も確実に表示
                const loginScreen = document.getElementById('loginScreen');
                if (loginScreen) {
                    loginScreen.style.display = 'flex';
                    loginScreen.style.opacity = '1';
                }
                showAuthError('読み込みに時間がかかっています。ページを再読み込みしてください。');
            }
        }, 3000);
    </script>
    
    <!-- Original Application Script -->
    <script src="app.js"></script>
</body>
</html>